<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PassVerter</title>
  <meta name="description" content="Simple Passverter: image, audio, video, docs, misc — minimal UI, high contrast, smooth. Enhanced UI/UX with real features." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#ffffff;--surface:#ffffff;--text:#030712;--muted:#334155;--accent:#0ea5a4;--accent-2:#06b6d4;--danger:#ef4444;--border:#0b1220;--radius:12px;--glass: rgba(11,18,32,0.04)
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0}
    html,body{height:100%;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}

    .wrap{max-width:1100px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:white;display:flex;align-items:center;justify-content:center;font-weight:800}
    h1{font-size:20px;margin:0}
    .sub{font-size:13px;color:var(--muted)}

    .layout{display:grid;grid-template-columns:220px 1fr;gap:18px}
    nav{background:var(--surface);border-radius:12px;padding:12px;border:2px solid var(--border);box-shadow:0 6px 18px var(--glass)}
    nav button{display:block;width:100%;padding:10px;border-radius:8px;border:0;background:transparent;text-align:left;color:var(--text);font-weight:600;margin-bottom:8px;cursor:pointer;transition:all .22s cubic-bezier(.2,.9,.2,1);transform-origin:left}
    nav button:hover{transform:translateX(4px)}
    nav button.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;box-shadow:0 6px 12px rgba(6,182,212,0.12)}

    main{background:var(--surface);border-radius:12px;padding:14px;border:2px solid var(--border);min-height:420px;position:relative;overflow:hidden}
    /* panel stacking to allow smooth transitions */
    main section{position:absolute;inset:0;padding:20px;opacity:0;transform:translateY(10px) scale(.995);pointer-events:none;transition:opacity .34s ease,transform .34s cubic-bezier(.22,.9,.2,1)}
    main section.active{opacity:1;transform:translateY(0) scale(1);pointer-events:auto}

    .drop{border:2px dashed var(--border);padding:18px;border-radius:10px;text-align:center;cursor:pointer;color:var(--muted);background:linear-gradient(180deg, rgba(14,165,164,0.03), transparent);transition:all .18s}
    .drop.hover{border-color:var(--accent);box-shadow:0 8px 30px rgba(6,182,212,0.06)}

    .controls{display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap}
    select,input{padding:8px;border-radius:8px;border:1px solid var(--border)}
    input[type=number]{-moz-appearance:textfield}
    .btn{padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:white;cursor:pointer;font-weight:700;transition:transform .14s,box-shadow .14s}
    .btn:hover{transform:translateY(-3px);box-shadow:0 10px 24px rgba(14,165,164,0.12)}
    .btn.ghost{background:transparent;color:var(--text);border:1px solid var(--border)}

    .files{margin-top:12px}
    .file{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.04);margin-bottom:8px;gap:10px;background:linear-gradient(180deg, rgba(255,255,255,0.6), transparent);transition:transform .18s,box-shadow .18s}
    .file:hover{transform:translateY(-4px);box-shadow:0 10px 22px rgba(11,18,32,0.04)}
    .file .meta{display:flex;gap:10px;align-items:center}
    .thumb{width:56px;height:56px;border-radius:6px;object-fit:cover;border:1px solid rgba(0,0,0,0.06)}
    .file small{color:var(--muted)}

    .file-actions{display:flex;gap:6px}
    .move{display:flex;flex-direction:column;gap:6px}
    .move button{padding:6px 8px;border-radius:6px;border:0;background:transparent;cursor:pointer;font-weight:700}

    .progress{height:8px;background:rgba(0,0,0,0.06);border-radius:8px;overflow:hidden;margin-top:10px}
    .progress>i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .2s}

    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}

    @media (max-width:880px){.layout{grid-template-columns:1fr}.logo{width:44px;height:44px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">PV</div>
        <div>
          <h1>Passverter</h1>
          <div class="sub">Simple • High-contrast • Smooth</div>
        </div>
      </div>
      <div class="sub">Client-only where possible — no servers</div>
    </header>

    <div class="layout">
      <nav>
        <button data-panel="image" class="active">Image</button>
        <button data-panel="audio">Audio</button>
        <button data-panel="video">Video</button>
        <button data-panel="doc">Document</button>
        <button data-panel="misc">Misc</button>
      </nav>

      <main>
        <!-- IMAGE -->
        <section id="panel-image" class="active">
          <h2>Image</h2>
          <div class="drop" id="imgDrop">Drop or click to select images (PNG, JPG, WebP)</div>

          <div class="controls">
            <select id="imgFormat"><option value="image/jpeg">JPG</option><option value="image/webp">WebP</option><option value="pdf">PDF</option></select>
            <label style="display:flex;gap:6px;align-items:center"><small class="sub">W</small><input id="imgWidth" type="number" min="1" placeholder="auto" style="width:90px"></label>
            <label style="display:flex;gap:6px;align-items:center"><small class="sub">H</small><input id="imgHeight" type="number" min="1" placeholder="auto" style="width:90px"></label>
            <label style="display:flex;gap:6px;align-items:center"><input id="imgKeep" type="checkbox" checked> Keep aspect</label>
            <input id="imgQuality" type="number" min="0.1" max="1" step="0.01" value="0.92" style="width:90px">
            <button class="btn" id="imgConvert">Convert</button>
          </div>

          <div class="files" id="imgFiles"></div>
          <div class="progress" id="imgProgress" style="display:none"><i></i></div>
          <div class="log" id="imgLog"></div>
        </section>

        <!-- AUDIO -->
        <section id="panel-audio">
          <h2>Audio</h2>
          <div class="drop" id="audioDrop">Drop or click to select audio (MP3, WAV)</div>
          <div class="controls">
            <select id="audioFormat"><option value="mp3">MP3</option><option value="wav">WAV</option><option value="ogg">OGG</option></select>
            <button class="btn" id="audioConvert">Convert (loads FFmpeg)</button>
          </div>
          <div class="files" id="audioFiles"></div>
          <div class="progress" id="audioProgress" style="display:none"><i></i></div>
          <div class="log" id="audioLog"></div>
        </section>

        <!-- VIDEO -->
        <section id="panel-video">
          <h2>Video</h2>
          <div class="drop" id="videoDrop">Drop or click to select video (MP4, WebM)</div>
          <div class="controls">
            <select id="videoFormat"><option value="mp4">MP4</option><option value="webm">WebM</option></select>
            <button class="btn" id="videoConvert">Convert (loads FFmpeg)</button>
          </div>
          <div class="files" id="videoFiles"></div>
          <div class="progress" id="videoProgress" style="display:none"><i></i></div>
          <div class="log" id="videoLog"></div>
        </section>

        <!-- DOC -->
        <section id="panel-doc">
          <h2>Document</h2>
          <div class="drop" id="docDrop">Drop DOCX / PDF / TXT</div>
          <div class="controls">
            <select id="docOp"><option value="docx2pdf">DOCX → PDF</option><option value="pdf2txt">PDF → TXT</option><option value="txt2pdf">TXT → PDF</option></select>
            <button class="btn" id="docConvert">Convert</button>
          </div>
          <div class="files" id="docFiles"></div>
          <div class="progress" id="docProgress" style="display:none"><i></i></div>
          <div class="log" id="docLog"></div>
        </section>

        <!-- MISC -->
        <section id="panel-misc">
          <h2>Misc</h2>
          <div class="drop" id="miscDrop">Drop GIF / ZIP</div>
          <div class="controls">
            <button class="btn" id="gifExtract">Extract GIF Frames</button>
          </div>
          <div class="files" id="miscFiles"></div>
          <div class="progress" id="miscProgress" style="display:none"><i></i></div>
          <div class="log" id="miscLog"></div>
        </section>
      </main>
    </div>

    <footer>Passverter — simple, private, high-contrast UI. Use files you own.</footer>
  </div>

  <!-- libs (loaded on demand) -->
  <script>
    // Smooth panel switching
    const panels = document.querySelectorAll('nav button[data-panel]');
    panels.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const target = document.getElementById('panel-'+btn.dataset.panel);
        document.querySelectorAll('main section').forEach(s=>s.classList.remove('active'));
        // allow CSS transitions by activating target after brief tick
        requestAnimationFrame(()=>{ target.classList.add('active'); });
      });
    });

    // Generic drop handler with visual feedback
    function makeDrop(id, acceptFn, onFiles){
      const el = document.getElementById(id);
      el.addEventListener('click', ()=>{ const inp = document.createElement('input'); inp.type='file'; inp.multiple=true; inp.onchange = e=> onFiles([...e.target.files].filter(acceptFn)); inp.click(); });
      el.addEventListener('dragover', e=>{ e.preventDefault(); el.classList.add('hover'); });
      el.addEventListener('dragleave', e=>{ el.classList.remove('hover'); });
      el.addEventListener('drop', e=>{ e.preventDefault(); const files=[...e.dataTransfer.files].filter(acceptFn); onFiles(files); el.classList.remove('hover'); });
    }

    // Helper: saveAs loader
    async function loadScript(src){ return new Promise((res,rej)=>{ const s=document.createElement('script'); s.src=src; s.onload=res; s.onerror=rej; document.head.appendChild(s); }); }

    // RENDER LIST: unified function for file lists with preview + move up/down
    function renderFileList(containerId, arr){ const c=document.getElementById(containerId); c.innerHTML=''; arr.forEach((f, idx)=>{
      const d=document.createElement('div'); d.className='file';
      const left=document.createElement('div'); left.className='meta';
      // thumbnail for images
      let thumbHTML = '';
      if(f.type && f.type.startsWith('image/')){
        const img = document.createElement('img'); img.className='thumb'; img.src = URL.createObjectURL(f); left.appendChild(img);
      }
      const info=document.createElement('div'); info.innerHTML=`<div style="font-weight:700">${f.name}</div><small>${Math.round(f.size/1024)} KB • ${f.type||'n/a'}</small>`;
      left.appendChild(info);

      const right=document.createElement('div'); right.className='file-actions';
      right.style.display='flex'; right.style.alignItems='center';

      const preview=document.createElement('button'); preview.className='btn ghost'; preview.textContent='Preview'; preview.onclick=()=>previewFile(f);
      const remove=document.createElement('button'); remove.className='btn ghost'; remove.textContent='Remove'; remove.onclick=()=>{ arr.splice(idx,1); renderFileList(containerId,arr); };

      // move up/down buttons
      const moveDiv = document.createElement('div'); moveDiv.className='move';
      const up = document.createElement('button'); up.textContent='▲'; up.title='Move up'; up.onclick=()=>{ if(idx>0){ arr.splice(idx-1,0,arr.splice(idx,1)[0]); renderFileList(containerId,arr); } };
      const down = document.createElement('button'); down.textContent='▼'; down.title='Move down'; down.onclick=()=>{ if(idx < arr.length-1){ arr.splice(idx+1,0,arr.splice(idx,1)[0]); renderFileList(containerId,arr); } };
      moveDiv.appendChild(up); moveDiv.appendChild(down);

      right.appendChild(preview); right.appendChild(remove); right.appendChild(moveDiv);
      d.appendChild(left); d.appendChild(right);
      c.appendChild(d);
    }); }

    function previewFile(f){ if(f.type && f.type.startsWith('image/')){ const w = window.open(''); const img = w.document.createElement('img'); img.src = URL.createObjectURL(f); img.style.maxWidth='100%'; w.document.body.style.margin='0'; w.document.body.appendChild(img); } else if(f.type && f.type.startsWith('audio/')){ const w = window.open(''); const a = w.document.createElement('audio'); a.controls=true; a.src = URL.createObjectURL(f); w.document.body.style.margin='0'; w.document.body.appendChild(a); } else if(f.type && f.type.startsWith('video/')){ const w = window.open(''); const v = w.document.createElement('video'); v.controls=true; v.src = URL.createObjectURL(f); v.style.maxWidth='100%'; w.document.body.style.margin='0'; w.document.body.appendChild(v); } else { alert('Preview not available'); } }

    // IMAGE logic (enhanced with resize inputs)
    let imageFiles = [];
    makeDrop('imgDrop', f=>f.type && f.type.startsWith('image/'), files=>{ imageFiles.push(...files); renderFileList('imgFiles', imageFiles); document.getElementById('imgLog').textContent = imageFiles.length+' file(s)'; });

    async function convertImage(file, mime, quality, targetW, targetH, keepAspect){
      const dataUrl = await new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); });
      const img = await new Promise((res,rej)=>{ const i=new Image(); i.onload=()=>res(i); i.onerror=rej; i.src=dataUrl; });
      // compute target size
      let destW = img.width, destH = img.height;
      if(targetW || targetH){
        if(keepAspect){
          if(targetW && !targetH){ destW = Math.max(1, Math.round(targetW)); destH = Math.round(img.height * (destW / img.width)); }
          else if(!targetW && targetH){ destH = Math.max(1, Math.round(targetH)); destW = Math.round(img.width * (destH / img.height)); }
          else { // both provided — fit inside preserving aspect
            const ratio = Math.min(targetW/img.width, targetH/img.height);
            destW = Math.max(1, Math.round(img.width * ratio)); destH = Math.max(1, Math.round(img.height * ratio));
          }
        } else {
          destW = targetW ? Math.max(1, Math.round(targetW)) : img.width;
          destH = targetH ? Math.max(1, Math.round(targetH)) : img.height;
        }
      }

      const canvas = document.createElement('canvas'); canvas.width = destW; canvas.height = destH; const ctx = canvas.getContext('2d'); ctx.drawImage(img,0,0,destW,destH);

      if(mime==='pdf'){
        const { jsPDF } = window.jspdf || {}; if(!jsPDF) throw new Error('jsPDF not loaded'); const pdf = new jsPDF({unit:'px',format:[canvas.width,canvas.height]}); const data = canvas.toDataURL('image/png', quality); pdf.addImage(data,'PNG',0,0,canvas.width,canvas.height); return pdf.output('blob');
      }
      const data = canvas.toDataURL(mime, quality); const blob = await (await fetch(data)).blob(); return blob;
    }

    document.getElementById('imgConvert').addEventListener('click', async ()=>{
      if(!imageFiles.length) return document.getElementById('imgLog').textContent='No images';
      const fmt = document.getElementById('imgFormat').value;
      const quality = parseFloat(document.getElementById('imgQuality').value) || 0.92;
      const wInput = parseInt(document.getElementById('imgWidth').value) || null;
      const hInput = parseInt(document.getElementById('imgHeight').value) || null;
      const keep = document.getElementById('imgKeep').checked;
      const bar = document.querySelector('#imgProgress i'); document.getElementById('imgProgress').style.display='block';
      try{
        const outputs = [];
        for(let i=0;i<imageFiles.length;i++){
          bar.style.width = Math.round((i/imageFiles.length)*100) + '%';
          const blob = await convertImage(imageFiles[i], fmt==='pdf' ? 'pdf' : fmt, quality, wInput, hInput, keep);
          const name = imageFiles[i].name.replace(/\.[^/.]+$/, '') + (fmt==='pdf'?'.pdf':'.'+(fmt.split('/')[1]||fmt));
          outputs.push({name,blob});
        }
        bar.style.width='100%';
        if(outputs.length>1){ if(!window.JSZip) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js'); const zip = new JSZip(); outputs.forEach(o=>zip.file(o.name,o.blob)); const z = await zip.generateAsync({type:'blob'}); if(!window.saveAs) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js'); saveAs(z,'passverter-images.zip'); }
        else { if(!window.saveAs) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js'); saveAs(outputs[0].blob, outputs[0].name); }
      }catch(e){ document.getElementById('imgLog').textContent = 'Error: '+e.message }
      document.getElementById('imgProgress').style.display='none';
    });

    // AUDIO & VIDEO: minimal ffmpeg loading when needed
    let ffmpeg = null, ffmpegReady = false;
    async function ensureFFmpeg(){ if(ffmpegReady) return; if(!window.createFFmpeg) await loadScript('https://unpkg.com/@ffmpeg/ffmpeg@0.11.7/dist/ffmpeg.min.js'); ffmpeg = createFFmpeg({log:false}); document.getElementById('audioLog').textContent='Loading FFmpeg…'; await ffmpeg.load(); ffmpegReady=true; document.getElementById('audioLog').textContent='FFmpeg ready'; }

    // AUDIO
    let audioFiles = [];
    makeDrop('audioDrop', f=>f.type && f.type.startsWith('audio/'), files=>{ audioFiles.push(...files); renderFileList('audioFiles', audioFiles); document.getElementById('audioLog').textContent = audioFiles.length+' file(s)'; });
    document.getElementById('audioConvert').addEventListener('click', async ()=>{
      if(!audioFiles.length) return document.getElementById('audioLog').textContent='No audio files';
      await ensureFFmpeg(); const fmt = document.getElementById('audioFormat').value; const bar = document.querySelector('#audioProgress i'); document.getElementById('audioProgress').style.display='block';
      try{
        const outs = [];
        for(let i=0;i<audioFiles.length;i++){
          bar.style.width = Math.round((i/audioFiles.length)*100) + '%';
          const f = audioFiles[i]; const data = await f.arrayBuffer(); const nameIn = 'in'+i+f.name.replace(/[^a-z0-9]/gi,'_'); ffmpeg.FS('writeFile', nameIn, new Uint8Array(data)); const outName = f.name.replace(/\.[^/.]+$/,'') + '.' + fmt; await ffmpeg.run('-i', nameIn, outName); const outData = ffmpeg.FS('readFile', outName); const blob = new Blob([outData.buffer],{type:'application/octet-stream'}); outs.push({name:outName,blob}); ffmpeg.FS('unlink', nameIn); ffmpeg.FS('unlink', outName);
        }
        bar.style.width='100%'; if(outs.length>1){ if(!window.JSZip) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js'); const zip = new JSZip(); outs.forEach(o=>zip.file(o.name,o.blob)); const z = await zip.generateAsync({type:'blob'}); if(!window.saveAs) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js'); saveAs(z,'passverter-audio.zip'); } else { if(!window.saveAs) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js'); saveAs(outs[0].blob, outs[0].name); }
      }catch(e){ document.getElementById('audioLog').textContent='Error: '+e.message }
      document.getElementById('audioProgress').style.display='none';
    });

    // VIDEO
    let videoFiles = [];
    makeDrop('videoDrop', f=>f.type && f.type.startsWith('video/'), files=>{ videoFiles.push(...files); renderFileList('videoFiles', videoFiles); document.getElementById('videoLog').textContent = videoFiles.length+' file(s)'; });
    document.getElementById('videoConvert').addEventListener('click', async ()=>{
      if(!videoFiles.length) return document.getElementById('videoLog').textContent='No video files';
      await ensureFFmpeg(); const fmt = document.getElementById('videoFormat').value; const bar = document.querySelector('#videoProgress i'); document.getElementById('videoProgress').style.display='block';
      try{
        const outs = [];
        for(let i=0;i<videoFiles.length;i++){
          bar.style.width = Math.round((i/videoFiles.length)*100) + '%';
          const f = videoFiles[i]; const data = await f.arrayBuffer(); const nameIn = 'vin'+i+f.name.replace(/[^a-z0-9]/gi,'_'); ffmpeg.FS('writeFile', nameIn, new Uint8Array(data)); const outName = f.name.replace(/\.[^/.]+$/,'') + '.' + fmt; await ffmpeg.run('-i', nameIn, '-c:v','libx264','-c:a','aac', outName); const outData = ffmpeg.FS('readFile', outName); const blob = new Blob([outData.buffer],{type:'application/octet-stream'}); outs.push({name:outName,blob}); ffmpeg.FS('unlink', nameIn); ffmpeg.FS('unlink', outName);
        }
        bar.style.width='100%'; if(outs.length>1){ if(!window.JSZip) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js'); const zip = new JSZip(); outs.forEach(o=>zip.file(o.name,o.blob)); const z = await zip.generateAsync({type:'blob'}); if(!window.saveAs) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js'); saveAs(z,'passverter-video.zip'); } else { if(!window.saveAs) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js'); saveAs(outs[0].blob, outs[0].name); }
      }catch(e){ document.getElementById('videoLog').textContent='Error: '+e.message }
      document.getElementById('videoProgress').style.display='none';
    });

    // DOC
    let docFiles = [];
    makeDrop('docDrop', f=>f.name.match(/\.(docx|pdf|txt)$/i), files=>{ docFiles.push(...files); renderFileList('docFiles', docFiles); document.getElementById('docLog').textContent = docFiles.length+' file(s)'; });

    async function loadLibsForDocs(){ if(!window.mammoth) await loadScript('https://unpkg.com/mammoth/mammoth.browser.min.js'); if(!window.jspdf) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js'); if(!window.pdfjsLib) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js'); }

    document.getElementById('docConvert').addEventListener('click', async ()=>{
      if(!docFiles.length) return document.getElementById('docLog').textContent='No files';
      await loadLibsForDocs(); const op = document.getElementById('docOp').value; const results = [];
      for(let i=0;i<docFiles.length;i++){
        const f = docFiles[i]; try{
          if(op==='docx2pdf' && f.name.match(/\.docx$/i)){
            document.getElementById('docLog').textContent='Converting '+f.name;
            const ab = await f.arrayBuffer(); const res = await mammoth.convertToHtml({arrayBuffer:ab}); const html = res.value; const { jsPDF } = window.jspdf; const pdf = new jsPDF(); await pdf.html('<div>'+html+'</div>'); const blob = pdf.output('blob'); results.push({name:f.name.replace(/\.[^/.]+$/,'')+'.pdf', blob});
          } else if(op==='pdf2txt' && f.name.match(/\.pdf$/i)){
            document.getElementById('docLog').textContent='Extracting text '+f.name; const ab = await f.arrayBuffer(); const pdfData = new Uint8Array(ab); const loadingTask = pdfjsLib.getDocument({data:pdfData}); const pdfDoc = await loadingTask.promise; let txt=''; for(let p=1;p<=pdfDoc.numPages;p++){ const page = await pdfDoc.getPage(p); const content = await page.getTextContent(); txt += content.items.map(it=>it.str).join(' ') + '\n\n'; } results.push({name:f.name.replace(/\.[^/.]+$/,'')+'.txt', blob:new Blob([txt],{type:'text/plain'})});
          } else if(op==='txt2pdf' && f.name.match(/\.txt$/i)){
            document.getElementById('docLog').textContent='Converting '+f.name; const txt = new TextDecoder().decode(await f.arrayBuffer()); const { jsPDF } = window.jspdf; const pdf = new jsPDF(); const lines = pdf.splitTextToSize(txt, 180); pdf.text(lines,10,10); results.push({name:f.name.replace(/\.[^/.]+$/,'')+'.pdf', blob:pdf.output('blob')});
          } else {
            document.getElementById('docLog').textContent='Unsupported file for chosen operation: '+f.name;
          }
        }catch(e){ document.getElementById('docLog').textContent='Error: '+e.message }
      }
      if(results.length>0){ if(results.length>1){ if(!window.JSZip) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js'); const zip = new JSZip(); results.forEach(r=>zip.file(r.name,r.blob)); const z = await zip.generateAsync({type:'blob'}); if(!window.saveAs) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js'); saveAs(z,'passverter-docs.zip'); } else { if(!window.saveAs) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js'); saveAs(results[0].blob, results[0].name); } }
    });

    // MISC: GIF frames
    let miscFiles = [];
    makeDrop('miscDrop', f=>f.name.match(/\.(gif|zip)$/i), files=>{ miscFiles.push(...files); renderFileList('miscFiles', miscFiles); document.getElementById('miscLog').textContent = miscFiles.length+' file(s)'; });
    document.getElementById('gifExtract').addEventListener('click', async ()=>{
      const gifs = miscFiles.filter(f=>f.name.match(/\.gif$/i)); if(!gifs.length) return document.getElementById('miscLog').textContent='No GIFs'; if(!window.gifuct) await loadScript('https://unpkg.com/gifuct-js/dist/gifuct.min.js'); if(!window.JSZip) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js');
      for(const g of gifs){ document.getElementById('miscLog').textContent='Extracting '+g.name; const ab = await g.arrayBuffer(); const parsed = gifuct.parseGIF(ab); const frames = gifuct.decompressFrames(parsed, true); const zip = new JSZip(); for(let i=0;i<frames.length;i++){ const frame = frames[i]; const c = document.createElement('canvas'); c.width = frame.dims.width; c.height = frame.dims.height; const ctx = c.getContext('2d'); const imgdata = ctx.createImageData(frame.dims.width, frame.dims.height); imgdata.data.set(frame.patch); ctx.putImageData(imgdata,0,0); const dataUrl = c.toDataURL('image/png'); const blob = await (await fetch(dataUrl)).blob(); zip.file(g.name.replace(/\.gif$/i,'')+'-frame-'+i+'.png', blob); } const z = await zip.generateAsync({type:'blob'}); if(!window.saveAs) await loadScript('https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js'); saveAs(z,g.name.replace(/\.gif$/i,'')+'-frames.zip'); document.getElementById('miscLog').textContent='Done'; }
    });

  </script>
</body>
</html>